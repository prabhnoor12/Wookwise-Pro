<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: 'Inter', sans-serif; background: #f9fafb; }
    #sidebar {
      position: fixed; top: 0; left: 0; width: 15rem; height: 100%;
      background: #1e3a8a; color: #fff; padding: 2rem 1rem 1rem 1rem;
      z-index: 50; overflow-y: auto; box-shadow: 2px 0 8px rgba(0,0,0,0.07);
      display: flex; flex-direction: column; gap: 2rem;
      transition: transform 0.3s;
      transform: translateX(-100%);
    }
    #sidebar.show-sidebar {
      transform: translateX(0);
    }
    #menuBtn {
      display: block;
      position: fixed;
      top: 1rem;
      left: 1rem;
      background-color: #2563eb;
      color: white;
      padding: 0.75rem;
      border-radius: 0.5rem;
      z-index: 60;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      font-size: 1.5rem;
      border: none;
      cursor: pointer;
      transition: background 0.2s;
    }
    #menuBtn:active, #menuBtn:hover {
      background-color: #1d4ed8;
    }
    #sidebarOverlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 40;
      display: none;
    }
    #sidebarOverlay.show-overlay {
      display: block;
    }
    .sidebar-nav a { display: block; padding: 0.75rem 1rem; border-radius: 0.5rem; color: #fff; text-decoration: none; font-weight: 500; margin-bottom: 0.25rem; transition: background 0.2s, color 0.2s; }
    .sidebar-nav a.active, .sidebar-nav a:hover { background: #2563eb; color: #fff; }
    .main-content { margin-left: 15rem; padding: 2.5rem 1.5rem 2rem 1.5rem; min-height: 100vh; background: #f9fafb; }
    .summary-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 1.25rem; margin: 2rem 0 2.5rem 0; }
    .summary-card { background: linear-gradient(135deg, #2563eb 60%, #60a5fa 100%); color: #fff; border-radius: 0.75rem; padding: 1.5rem 1.25rem; box-shadow: 0 2px 8px rgba(37,99,235,0.08); display: flex; flex-direction: column; align-items: flex-start; min-height: 90px; position: relative; overflow: hidden; font-size: 1.1rem; }
    .summary-card .icon { font-size: 1.5rem; margin-bottom: 0.25rem; opacity: 0.85; }
    .summary-card .value { font-size: 1.5rem; font-weight: 700; margin-bottom: 0.1rem; }
    .summary-card .label { font-size: 1rem; opacity: 0.95; font-weight: 500; }
    .section-title { font-size: 1.25rem; font-weight: 700; color: #1e3a8a; margin-bottom: 0.75rem; margin-top: 2rem; letter-spacing: 0.01em; }
    .schedule-list { background: #fff; border-radius: 0.5rem; box-shadow: 0 2px 8px rgba(0,0,0,0.04); padding: 1rem 1.25rem; margin-bottom: 2rem; }
    .schedule-item { display: flex; align-items: center; gap: 1rem; padding: 0.5rem 0; border-bottom: 1px solid #e5e7eb; font-size: 1rem; }
    .schedule-item:last-child { border-bottom: none; }
    .recent-table { width: 100%; background: #fff; border-radius: 0.5rem; box-shadow: 0 2px 8px rgba(0,0,0,0.04); margin-bottom: 1rem; overflow: hidden; }
    .recent-table th, .recent-table td { padding: 0.75rem 1rem; text-align: left; font-size: 1rem; }
    .recent-table th { background: #f1f5f9; font-weight: 600; color: #1e293b; }
    .recent-table tr { border-bottom: 1px solid #e5e7eb; }
    .recent-table tr:last-child { border-bottom: none; }
    .recent-table td { background: #fff; }
    .view-all-btn { display: inline-block; margin-top: 0.5rem; background: #2563eb; color: #fff; padding: 0.5rem 1.25rem; border-radius: 0.5rem; font-weight: 600; text-decoration: none; transition: background 0.2s; }
    .view-all-btn:hover { background: #1d4ed8; }
    .chart-placeholder, #weeklyChart { background: #f1f5f9; border-radius: 0.5rem; height: 220px; display: flex; align-items: center; justify-content: center; color: #64748b; font-size: 1.1rem; margin-top: 1.5rem; margin-bottom: 2rem; border: 1px dashed #cbd5e1; }
    .search-row { display: flex; align-items: center; gap: 1rem; margin-bottom: 1.5rem; background: #f1f5f9; border-radius: 0.5rem; padding: 0.75rem 1rem; }
    .search-row input[type="search"] { border: none; background: transparent; font-size: 1rem; outline: none; width: 160px; color: #1e293b; }
    .search-row input[type="search"]::placeholder { color: #64748b; opacity: 1; }
    .search-row .today { margin-left: auto; font-size: 1rem; color: #2563eb; font-weight: 500; display: flex; align-items: center; gap: 0.5rem; }
    @media (min-width: 1024px) {
      #sidebar {
        width: 15rem;
        transform: translateX(0);
        position: fixed;
        top: 0;
        left: 0;
        display: flex;
      }
      #menuBtn {
        display: none;
      }
      #sidebarOverlay {
        display: none;
      }
      .main-content {
        margin-left: 15rem;
        margin-top: 0;
      }
    }
    @media (max-width: 1023px) {
      #sidebar {
        width: 80vw;
        max-width: 14rem;
        padding: 1.25rem 1rem;
        /* Hide sidebar by default on mobile */
        transform: translateX(-100%);
        display: flex;
      }
      #sidebar.show-sidebar {
        transform: translateX(0);
      }
      .main-content {
        margin-left: 0;
        margin-top: 3.5rem;
        padding: 1rem 0.5rem 2rem 0.5rem;
      }
      .container {
        padding: 1.25rem 0.5rem;
      }
      .summary-cards {
        grid-template-columns: 1fr;
        gap: 1rem;
      }
    }
  </style>
</head>
<body>
  <button id="menuBtn" aria-label="Open menu">☰</button>
  <div id="sidebarOverlay"></div>
  <div class="flex">
    <!-- Sidebar -->
    <aside id="sidebar" class="shadow-2xl">
      <!-- Logo & Brand -->
      <div class="flex items-center gap-3 mb-8 px-2">
        <img src="https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f4bc.png" alt="Logo" class="w-9 h-9 rounded-lg shadow" />
        <span class="text-2xl font-extrabold tracking-tight text-white drop-shadow">Sexy SaaS</span>
      </div>
      <!-- Main Navigation -->
      <nav class="sidebar-nav flex flex-col gap-1">
        <div class="uppercase text-xs text-blue-200 tracking-widest px-3 mb-1 mt-2">Main</div>
        <a href="Dashboard.html" class="group flex items-center gap-3 px-4 py-2 rounded-lg font-medium text-white transition-all hover:bg-blue-700 hover:text-white hover:pl-6 active:bg-blue-900 focus:bg-blue-800 focus:outline-none
          active flex-shrink-0">
          <span class="material-icons text-blue-200 group-hover:text-white transition">dashboard</span>
          Dashboard
        </a>
        <a href="Booking.html" class="group flex items-center gap-3 px-4 py-2 rounded-lg font-medium text-white transition-all hover:bg-blue-700 hover:text-white hover:pl-6 flex-shrink-0">
          <span class="material-icons text-blue-200 group-hover:text-white transition">event</span>
          Bookings
        </a>
        <a href="#" onclick="alert('Clients page coming soon!');return false;" class="group flex items-center gap-3 px-4 py-2 rounded-lg font-medium text-white transition-all hover:bg-blue-700 hover:text-white hover:pl-6 flex-shrink-0">
          <span class="material-icons text-blue-200 group-hover:text-white transition">people</span>
          Clients
          <span class="ml-auto text-xs bg-yellow-100 text-yellow-700 px-2 py-0.5 rounded">Soon</span>
        </a>
        <div class="border-t border-blue-900/30 my-3"></div>
        <div class="uppercase text-xs text-blue-200 tracking-widest px-3 mb-1">Management</div>
        <a href="ServiceManagement.html" class="group flex items-center gap-3 px-4 py-2 rounded-lg font-medium text-white transition-all hover:bg-blue-700 hover:text-white hover:pl-6 flex-shrink-0">
          <span class="material-icons text-blue-200 group-hover:text-white transition">build</span>
          Services
        </a>
        <a href="Settings.html" class="group flex items-center gap-3 px-4 py-2 rounded-lg font-medium text-white transition-all hover:bg-blue-700 hover:text-white hover:pl-6 flex-shrink-0">
          <span class="material-icons text-blue-200 group-hover:text-white transition">settings</span>
          Settings
        </a>
      </nav>
      <!-- Footer Links -->
      <div class="mt-auto pt-8 border-t border-blue-900/30 text-sm text-blue-200 flex flex-col gap-2 px-2">
        <div class="flex items-center gap-2">
          <span class="material-icons" style="font-size:1.1rem;">help_outline</span>
          <a href="#" class="hover:underline text-blue-100">Help Center</a>
        </div>
        <div class="flex items-center gap-2">
          <span class="material-icons" style="font-size:1.1rem;">logout</span>
          <a href="#" class="hover:underline text-blue-100">Sign Out</a>
        </div>
        <div class="text-xs text-blue-300 mt-2 text-center">© 2024 Sexy SaaS</div>
      </div>
    </aside>
    <!-- Main Content -->
    <div class="flex-1 main-content">
      <div class="container">
        <!-- User Profile Dropdown -->
        <div class="flex items-center justify-end mb-4 gap-3">
          <div class="relative group">
            <button id="profileBtn" class="flex items-center gap-2 px-3 py-2 rounded-lg bg-white shadow hover:bg-blue-50 focus:outline-none" aria-haspopup="true" aria-expanded="false">
              <img src="https://i.pravatar.cc/40?img=3" alt="User Avatar" class="w-8 h-8 rounded-full border border-blue-200" />
              <span class="font-semibold text-blue-900">Admin</span>
              <span class="material-icons text-blue-700">expand_more</span>
            </button>
            <div id="profileDropdown" class="absolute right-0 mt-2 w-40 bg-white rounded-lg shadow-lg border border-blue-100 py-2 z-50 hidden group-focus:block group-hover:block">
              <a href="#" class="block px-4 py-2 text-blue-900 hover:bg-blue-50">Profile</a>
              <a href="#" class="block px-4 py-2 text-blue-900 hover:bg-blue-50">Notifications</a>
              <a href="#" class="block px-4 py-2 text-blue-900 hover:bg-blue-50">Logout</a>
            </div>
          </div>
        </div>
        <!-- Live Clock -->
        <div class="flex justify-end mb-2">
          <span id="liveClock" class="text-blue-700 font-mono text-lg"></span>
        </div>
        <!-- Search & Today Row -->
        <div class="search-row">
          <span class="material-icons" style="font-size:1.3rem;opacity:0.7;">search</span>
          <input type="search" placeholder="Search..." aria-label="Search" />
          <span class="today">⏰ Today: Jun 5, 2025</span>
        </div>
        <!-- Summary Cards -->
        <div class="summary-cards">
          <div class="summary-card"><span class="icon">📅</span><span class="value">4</span><span class="label">Bookings Today</span></div>
          <div class="summary-card"><span class="icon">💰</span><span class="value">€240</span><span class="label">Earnings This Week</span></div>
          <div class="summary-card"><span class="icon">👥</span><span class="value">3</span><span class="label">New Clients</span></div>
          <div class="summary-card"><span class="icon">🕐</span><span class="value">0</span><span class="label">No-shows</span></div>
        </div>
        <!-- Today's Schedule -->
        <div class="section-title">📆 Today's Schedule</div>
        <div class="schedule-list">
          <div class="schedule-item"><span>10:00</span> - <b>Haircut</b> - Alice Smith</div>
          <div class="schedule-item"><span>11:00</span> - <b>Hair Color</b> - Lara Müller</div>
          <div class="schedule-item"><span>14:00</span> - <b>Zoom Yoga</b> - Raj Patel</div>
        </div>
        <!-- Recent Bookings Table -->
        <div class="section-title">📋 Recent Bookings</div>
        <div class="recent-table-wrapper">
          <table class="recent-table">
            <thead>
              <tr>
                <th>Name</th>
                <th>Service</th>
                <th>Date/Time</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Lara Müller</td>
                <td>Hair Color</td>
                <td>Jun 5, 11:00</td>
                <td><span class="inline-block px-2 py-1 rounded bg-blue-100 text-blue-800 text-xs font-semibold">Booked</span></td>
              </tr>
              <tr>
                <td>Raj Patel</td>
                <td>Zoom Yoga</td>
                <td>Jun 5, 14:00</td>
                <td><span class="inline-block px-2 py-1 rounded bg-blue-100 text-blue-800 text-xs font-semibold">Booked</span></td>
              </tr>
            </tbody>
          </table>
          <a href="Booking.html" class="view-all-btn">View All Bookings</a>
        </div>
        <!-- Chart -->
        <div class="section-title flex items-center gap-2">
          <span>📊</span>
          <span>Weekly Summary Chart</span>
          <button id="exportChartBtn" class="ml-auto px-3 py-1 bg-blue-100 text-blue-700 rounded hover:bg-blue-200 text-sm font-semibold flex items-center gap-1" title="Export chart as image">
            <span class="material-icons" style="font-size:1.1rem;">download</span>Export
          </button>
        </div>
        <div class="w-full max-w-2xl mx-auto">
          <div class="bg-white rounded-xl shadow-lg border border-blue-100 p-4 pb-2 relative">
            <!-- Chart Loading Skeleton -->
            <div id="chartSkeleton" class="absolute inset-0 flex items-center justify-center bg-white bg-opacity-80 z-10" style="display:none;">
              <div class="w-full">
                <div class="h-6 bg-blue-100 rounded mb-3 w-1/3 mx-auto animate-pulse"></div>
                <div class="flex gap-2 items-end h-32">
                  <div class="bg-blue-200 rounded w-8 h-12 animate-pulse"></div>
                  <div class="bg-blue-200 rounded w-8 h-20 animate-pulse"></div>
                  <div class="bg-blue-200 rounded w-8 h-16 animate-pulse"></div>
                  <div class="bg-blue-200 rounded w-8 h-10 animate-pulse"></div>
                  <div class="bg-blue-200 rounded w-8 h-24 animate-pulse"></div>
                  <div class="bg-blue-200 rounded w-8 h-14 animate-pulse"></div>
                  <div class="bg-blue-200 rounded w-8 h-18 animate-pulse"></div>
                </div>
              </div>
            </div>
            <canvas id="weeklyChart" height="180" aria-label="Weekly Bookings Chart" role="img"></canvas>
          </div>
        </div>
        <!-- Toast Notification -->
        <div id="toast" class="fixed top-6 right-6 z-50 bg-red-600 text-white px-4 py-2 rounded shadow-lg hidden" role="alert"></div>
        <!-- Loading Spinner Overlay -->
        <div id="loadingOverlay" class="fixed inset-0 bg-white bg-opacity-70 flex items-center justify-center z-50 hidden">
          <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-blue-600 border-b-4 border-blue-200"></div>
        </div>
      </div>
    </div>
  </div>
  <script>
    // Fetch dashboard data from API and update widgets
    async function loadDashboard() {
      showLoading(true);
      showChartSkeleton(true);
      try {
        const res = await fetch('/api/dashboard');
        if (!res.ok) throw new Error('Failed to load dashboard');
        const data = await res.json();

        // Update summary cards
        // Example assumes you add IDs to the value spans in summary cards
        // document.getElementById('bookingsToday').textContent = data.bookingsToday;
        // document.getElementById('earningsWeek').textContent = '€' + data.earningsWeek;
        // document.getElementById('newClients').textContent = data.newClients;
        // document.getElementById('noShows').textContent = data.noShows;

        // Update Today's Schedule
        // const scheduleList = document.querySelector('.schedule-list');
        // scheduleList.innerHTML = '';
        // data.todaysSchedule.forEach(item => {
        //   const div = document.createElement('div');
        //   div.className = 'schedule-item';
        //   div.innerHTML = `<span>${item.time}</span> - <b>${item.service}</b> - ${item.client}`;
        //   scheduleList.appendChild(div);
        // });

        // Update Recent Bookings Table
        // const tbody = document.querySelector('.recent-table tbody');
        // tbody.innerHTML = '';
        // data.recentBookings.forEach(b => {
        //   const tr = document.createElement('tr');
        //   tr.innerHTML = `<td>${b.name}</td><td>${b.service}</td><td>${b.datetime}</td>
        //     <td><span class="inline-block px-2 py-1 rounded bg-blue-100 text-blue-800 text-xs font-semibold">${b.status}</span></td>`;
        //   tbody.appendChild(tr);
        // });

        // Update Weekly Chart
        if (data.weeklyChart) {
          updateWeeklyChart(data.weeklyChart.labels, data.weeklyChart.data);
        }
        showLoading(false);
        setTimeout(() => showChartSkeleton(false), 400); // smooth fade-out
      } catch (err) {
        showLoading(false);
        showChartSkeleton(false);
        showToast('Dashboard error: ' + (err.message || 'Unknown error'));
      }
    }

    // Chart.js Weekly Bookings Chart (initialize with empty data)
    let weeklyChartInstance;
    function updateWeeklyChart(labels, data) {
      if (weeklyChartInstance) {
        weeklyChartInstance.data.labels = labels;
        weeklyChartInstance.data.datasets[0].data = data;
        weeklyChartInstance.update();
      }
    }
    window.addEventListener('DOMContentLoaded', () => {
      // Sidebar menu toggle
      const menuBtn = document.getElementById('menuBtn');
      const sidebar = document.getElementById('sidebar');
      const sidebarOverlay = document.getElementById('sidebarOverlay');
      menuBtn.addEventListener('click', () => {
        sidebar.classList.toggle('show-sidebar');
        sidebarOverlay.classList.toggle('show-overlay');
      });
      sidebarOverlay.addEventListener('click', () => {
        sidebar.classList.remove('show-sidebar');
        sidebarOverlay.classList.remove('show-overlay');
      });

      // Initialize Chart.js with empty data
      const ctx = document.getElementById('weeklyChart').getContext('2d');
      weeklyChartInstance = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: [],
          datasets: [{
            label: 'Bookings',
            data: [],
            backgroundColor: '#2563eb',
            borderRadius: 6,
            maxBarThickness: 32
          }]
        },
        options: {
          plugins: { legend: { display: false } },
          scales: {
            x: { grid: { display: false }, ticks: { color: '#64748b', font: { weight: 600 } } },
            y: { beginAtZero: true, grid: { color: '#e5e7eb' }, ticks: { color: '#64748b' } }
          }
        }
      });

      // Show/hide loading overlay
      function showLoading(show) {
        document.getElementById('loadingOverlay').style.display = show ? 'flex' : 'none';
      }

      // Show/hide chart skeleton
      function showChartSkeleton(show) {
        document.getElementById('chartSkeleton').style.display = show ? 'flex' : 'none';
      }

      // Toast notification
      function showToast(msg, timeout = 2500) {
        const toast = document.getElementById('toast');
        toast.textContent = msg;
        toast.classList.remove('hidden');
        setTimeout(() => toast.classList.add('hidden'), timeout);
      }

      // Export chart as image
      document.getElementById('exportChartBtn').addEventListener('click', function() {
        const chart = document.getElementById('weeklyChart');
        const link = document.createElement('a');
        link.download = 'weekly-bookings-chart.png';
        link.href = chart.toDataURL('image/png');
        link.click();
      });

      // Live clock
      function updateClock() {
        const now = new Date();
        document.getElementById('liveClock').textContent =
          now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', second: '2-digit' });
      }
      setInterval(updateClock, 1000);
      updateClock();

      // Profile dropdown toggle
      document.getElementById('profileBtn').addEventListener('click', function(e) {
        e.stopPropagation();
        const dd = document.getElementById('profileDropdown');
        dd.classList.toggle('hidden');
        this.setAttribute('aria-expanded', dd.classList.contains('hidden') ? 'false' : 'true');
      });
      document.body.addEventListener('click', function() {
        document.getElementById('profileDropdown').classList.add('hidden');
        document.getElementById('profileBtn').setAttribute('aria-expanded', 'false');
      });

      // Accessibility: keyboard navigation for sidebar
      document.querySelectorAll('.sidebar-nav a').forEach(a => {
        a.addEventListener('keydown', function(e) {
          if (e.key === 'Enter' || e.key === ' ') this.click();
        });
      });

      // Load dashboard data from API
      loadDashboard();
    });
  </script>
  <!-- Material Icons for search icon (optional, fallback to emoji if not loaded) -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</body>
</html>
